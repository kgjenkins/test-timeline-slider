<html lang = "en">

<head>

<meta charset = "UTF-8" />
<title>Leaflet Timeline Slider</title>

<link rel="stylesheet" href="leaflet/leaflet.css"/>
<script src="leaflet/leaflet.js"></script>

<!-- jquery is required by leaflet-timeline-slider -->
<script src="jquery-3.3.1.min.js"></script>
<script src="leaflet-timeline-slider.js"></script>

<style>
body { font-family: Arial, sans-serif }
#person { font-size: 36pt }
#mymap { height: 600px }
</style>

</head>

<body>
    <h1 id="person"></h1>
    <div id="map" style="height: 600px;">
    </div>
    <script type="text/javascript">
        // features should be in the order that they should appear on the timeline
        // title should be unique for each feature
        let data = {
            "type": "FeatureCollection",
            "name": "points",
            "features": [
                { "type": "Feature", "properties": { "title": "Student Katagiri", "person": "Yukiko Katagiri", "location": "Tokyo", "date": "1978 December", "description": "Yukiko Katagiri starts her Aikido journey at 26 years old while in graduate school in Tokyo, Japan." }, "geometry": { "type": "Point", "coordinates": [ 139.7701297, 35.6797905 ] } },
                { "type": "Feature", "properties": { "title": "Trip to Ithaca", "person": "Yukiko Katagiri", "location": "Ithaca", "date": "1979 June", "description": "Thanks to Eleanor Jorden who founded the japanese linguistics at Cornell, invited Katagiri Sensei to Cornell for 6-7 weeks. At this time she practiced as a student at an earlier version of the Cornell Aikido Club." }, "geometry": { "type": "Point", "coordinates": [ -76.4827233, 42.4475711 ] } },
                { "type": "Feature", "properties": { "title": "A Longer Stay", "person": "Yukiko Katagiri", "location": "Ithaca", "date": "1980", "description": "Yukiko Katagiri came to Cornell to teach Japanese, and founded a new iteration of the Aikido Club. She joined under a 2nd degree black belt and practiced with the group for three years before going back to Japan." }, "geometry": { "type": "Point", "coordinates": [ -76.4823637, 42.4475711 ] } },
                { "type": "Feature", "properties": { "title": "A Further Education", "person": "Yukiko Katagiri", "location": "Ithaca", "date": "1985", "description": "Yukiko Katagiri, now a once again, 2nd degree black belt in Aikido herself, returned to Ithaca to pursue her Ph.D.. She started teaching at the Aikido Club." }, "geometry": { "type": "Point", "coordinates": [ -76.4819816, 42.4475711 ] } },
                { "type": "Feature", "properties": { "title": "Visit Home", "person": "Yukiko Katagiri", "location": "Tokyo", "date": "1989", "description": "Yukiko Katagiri and her husband went back to Japan for a year." }, "geometry": { "type": "Point", "coordinates": [ 139.7733889, 35.6800265 ] } },
                { "type": "Feature", "properties": { "title": "Conference", "person": "Yukiko Katagiri", "location": "Belgium", "date": "1995", "description": "Sensei Katagiri attended an Aikido camps in Belgium, where she practiced with practitioners from all over the world and had conversations about their teaching experiences." }, "geometry": { "type": "Point", "coordinates": [ 4.359783, 50.847343 ] } },
            ]
        }
        let mymap = L.map('map')
        mymap.fitWorld()
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(mymap);
        
        let updateMarkers = function( {label, value, map} ) {
            // remove any previous markerts
            map.eachLayer(function (layer) {
                    if (layer instanceof L.Marker) {
                        map.removeLayer(layer);
                    }
            });
            // get the selected timeline entry
            // (subtracting 1 because timeline-slider starts at 1 instead of 0)
            let selected = data.features[value-1]
            let item // this will hold the created layer
            L.geoJson(selected, {
                onEachFeature: function onEachFeature(feature, layer) {
                    let p = feature.properties
                    content = `<h2>${p.title}</h2>${p.location}, ${p.date}<p>${p.description}</p>`
                    var popup = L.popup().setContent(content);
                    layer.bindPopup(popup);
                    item = layer
                }
            }).addTo(map);
            
            // update the person's name at top of page
            document.querySelector('#person').innerHTML = item.feature.properties.person
            // fly to the location -- 2nd param is zoom level, duration in seconds
            map.flyTo(item.getLatLng(), 4, { duration: 2})
            
            // automatically show the info for this item
            item.openPopup()
        };
        // get titles from the data to use as timeline labels
        let titles = data.features.map(x => x.properties.title)
        L.control.timelineSlider({
            timelineItems: titles, 
            changeMap: updateMarkers
        })
        .addTo(mymap);             
    </script>
</body>

</html>